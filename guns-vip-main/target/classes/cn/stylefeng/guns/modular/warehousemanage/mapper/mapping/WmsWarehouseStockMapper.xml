<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.stylefeng.guns.modular.warehousemanage.mapper.WmsWarehouseStockMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.stylefeng.guns.modular.warehousemanage.entity.WmsWarehouseStock">
        <id column="id" property="id" />
        <result column="loca_number" property="locaNumber" />
        <result column="roadway" property="roadway" />
        <result column="loca_row" property="locaRow" />
        <result column="loca_col" property="locaCol" />
        <result column="loca_layer" property="locaLayer" />
        <result column="loca_equipment" property="locaEquipment" />
        <result column="loca_state" property="locaState" />
        <result column="turnover_id" property="turnoverId" />
        <result column="mark" property="mark" />
        <result column="spare_field" property="spareField" />
        <result column="create_time" property="createTime" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id AS "id", loca_number AS "locaNumber", roadway AS "roadway", loca_row AS "locaRow", loca_col AS "locaCol", loca_layer AS "locaLayer", loca_equipment AS "locaEquipment", loca_state AS "locaState", turnover_id AS "turnoverId", mark AS "mark",spare_field AS "spareField", create_time AS "createTime"
    </sql>

    <select id="findByJoinOn" resultType="cn.stylefeng.guns.modular.warehousemanage.entity.WmsWarehouseStock">
        select
        stock.id AS "id",
        stock.loca_number AS "locaNumber",
        stock.roadway AS "roadway",
        stock.loca_row AS "locaRow",
        stock.loca_col AS "locaCol",
        stock.loca_layer AS "locaLayer",
        stock.loca_equipment AS "locaEquipment",
        stock.loca_state AS "locaState",
        stock.turnover_id AS "turnoverId",
--         stock.material_type_id AS "materialTypeId",
--         stock.material_name AS "materialName",
--         stock.material_sku AS "materialSku",
        stock.create_time AS "createTime"
        FROM wms_warehouse_stock as stock, wms_warehouse_turnover as turnover
        WHERE stock.loca_state = '0' and turnover.turnover_state = '0' and stock.turnover_id = turnover.id
    </select>

    <select id="customList" resultType="cn.stylefeng.guns.modular.warehousemanage.model.result.WmsWarehouseStockResult" parameterType="cn.stylefeng.guns.modular.warehousemanage.model.params.WmsWarehouseStockParam">
        select
        <include refid="Base_Column_List"/>
        from wms_warehouse_stock where 1 = 1
            <if test="paramCondition.id != null and paramCondition.id != ''">
                and id like CONCAT('%',#{paramCondition.id},'%')
            </if>
            <if test="paramCondition.locaNumber != null and paramCondition.locaNumber != ''">
                and loca_number like CONCAT('%',#{paramCondition.locaNumber},'%')
            </if>
            <if test="paramCondition.roadway != null and paramCondition.roadway != ''">
                and roadway like CONCAT('%',#{paramCondition.roadway},'%')
            </if>
            <if test="paramCondition.locaRow != null and paramCondition.locaRow != ''">
                and loca_row like CONCAT('%',#{paramCondition.locaRow},'%')
            </if>
            <if test="paramCondition.locaCol != null and paramCondition.locaCol != ''">
                and loca_col like CONCAT('%',#{paramCondition.locaCol},'%')
            </if>
            <if test="paramCondition.locaLayer != null and paramCondition.locaLayer != ''">
                and loca_layer like CONCAT('%',#{paramCondition.locaLayer},'%')
            </if>
            <if test="paramCondition.locaEquipment != null and paramCondition.locaEquipment != ''">
                and loca_equipment like CONCAT('%',#{paramCondition.locaEquipment},'%')
            </if>
            <if test="paramCondition.locaState != null and paramCondition.locaState != ''">
                and loca_state like CONCAT('%',#{paramCondition.locaState},'%')
            </if>
            <if test="paramCondition.turnoverId != null and paramCondition.turnoverId != ''">
                and turnover_id like CONCAT('%',#{paramCondition.turnoverId},'%')
            </if>
            <if test="paramCondition.createTime != null and paramCondition.createTime != ''">
                and create_time like CONCAT('%',#{paramCondition.createTime},'%')
            </if>
    </select>

    <select id="customMapList" resultType="map" parameterType="cn.stylefeng.guns.modular.warehousemanage.model.params.WmsWarehouseStockParam">
        select
        <include refid="Base_Column_List"/>
        from wms_warehouse_stock where 1 = 1
            <if test="paramCondition.id != null and paramCondition.id != ''">
                and id like CONCAT('%',#{paramCondition.id},'%')
            </if>
            <if test="paramCondition.locaNumber != null and paramCondition.locaNumber != ''">
                and loca_number like CONCAT('%',#{paramCondition.locaNumber},'%')
            </if>
            <if test="paramCondition.roadway != null and paramCondition.roadway != ''">
                and roadway like CONCAT('%',#{paramCondition.roadway},'%')
            </if>
            <if test="paramCondition.locaRow != null and paramCondition.locaRow != ''">
                and loca_row like CONCAT('%',#{paramCondition.locaRow},'%')
            </if>
            <if test="paramCondition.locaCol != null and paramCondition.locaCol != ''">
                and loca_col like CONCAT('%',#{paramCondition.locaCol},'%')
            </if>
            <if test="paramCondition.locaLayer != null and paramCondition.locaLayer != ''">
                and loca_layer like CONCAT('%',#{paramCondition.locaLayer},'%')
            </if>
            <if test="paramCondition.locaEquipment != null and paramCondition.locaEquipment != ''">
                and loca_equipment like CONCAT('%',#{paramCondition.locaEquipment},'%')
            </if>
            <if test="paramCondition.locaState != null and paramCondition.locaState != ''">
                and loca_state like CONCAT('%',#{paramCondition.locaState},'%')
            </if>
            <if test="paramCondition.turnoverId != null and paramCondition.turnoverId != ''">
                and turnover_id like CONCAT('%',#{paramCondition.turnoverId},'%')
            </if>
            <if test="paramCondition.createTime != null and paramCondition.createTime != ''">
                and create_time like CONCAT('%',#{paramCondition.createTime},'%')
            </if>
    </select>

    <select id="customPageList" resultType="cn.stylefeng.guns.modular.warehousemanage.model.result.WmsWarehouseStockResult" parameterType="cn.stylefeng.guns.modular.warehousemanage.model.params.WmsWarehouseStockParam">
        select
        <include refid="Base_Column_List"/>
        from wms_warehouse_stock where 1 = 1
            <if test="paramCondition.id != null and paramCondition.id != ''">
                and id like CONCAT('%',#{paramCondition.id},'%')
            </if>
            <if test="paramCondition.locaNumber != null and paramCondition.locaNumber != ''">
                and loca_number like CONCAT('%',#{paramCondition.locaNumber},'%')
            </if>
            <if test="paramCondition.roadway != null and paramCondition.roadway != ''">
                and roadway like CONCAT('%',#{paramCondition.roadway},'%')
            </if>
            <if test="paramCondition.locaRow != null and paramCondition.locaRow != ''">
                and loca_row like CONCAT('%',#{paramCondition.locaRow},'%')
            </if>
            <if test="paramCondition.locaCol != null and paramCondition.locaCol != ''">
                and loca_col like CONCAT('%',#{paramCondition.locaCol},'%')
            </if>
            <if test="paramCondition.locaLayer != null and paramCondition.locaLayer != ''">
                and loca_layer like CONCAT('%',#{paramCondition.locaLayer},'%')
            </if>
            <if test="paramCondition.locaEquipment != null and paramCondition.locaEquipment != ''">
                and loca_equipment like CONCAT('%',#{paramCondition.locaEquipment},'%')
            </if>
            <if test="paramCondition.locaState != null and paramCondition.locaState != ''">
                and loca_state like CONCAT('%',#{paramCondition.locaState},'%')
            </if>
            <if test="paramCondition.turnoverId != null and paramCondition.turnoverId != ''">
                and turnover_id like CONCAT('%',#{paramCondition.turnoverId},'%')
            </if>
            <if test="paramCondition.createTime != null and paramCondition.createTime != ''">
                and create_time like CONCAT('%',#{paramCondition.createTime},'%')
            </if>
    </select>

    <select id="customPageMapList" resultType="map" parameterType="cn.stylefeng.guns.modular.warehousemanage.model.params.WmsWarehouseStockParam">
        select
        <include refid="Base_Column_List"/>
        from wms_warehouse_stock where 1 = 1
            <if test="paramCondition.id != null and paramCondition.id != ''">
                and id like CONCAT('%',#{paramCondition.id},'%')
            </if>
            <if test="paramCondition.locaNumber != null and paramCondition.locaNumber != ''">
                and loca_number like CONCAT('%',#{paramCondition.locaNumber},'%')
            </if>
            <if test="paramCondition.roadway != null and paramCondition.roadway != ''">
                and roadway like CONCAT('%',#{paramCondition.roadway},'%')
            </if>
            <if test="paramCondition.locaRow != null and paramCondition.locaRow != ''">
                and loca_row like CONCAT('%',#{paramCondition.locaRow},'%')
            </if>
            <if test="paramCondition.locaCol != null and paramCondition.locaCol != ''">
                and loca_col like CONCAT('%',#{paramCondition.locaCol},'%')
            </if>
            <if test="paramCondition.locaLayer != null and paramCondition.locaLayer != ''">
                and loca_layer like CONCAT('%',#{paramCondition.locaLayer},'%')
            </if>
            <if test="paramCondition.locaEquipment != null and paramCondition.locaEquipment != ''">
                and loca_equipment like CONCAT('%',#{paramCondition.locaEquipment},'%')
            </if>
            <if test="paramCondition.locaState != null and paramCondition.locaState != ''">
                and loca_state like CONCAT('%',#{paramCondition.locaState},'%')
            </if>
            <if test="paramCondition.turnoverId != null and paramCondition.turnoverId != ''">
                and turnover_id like CONCAT('%',#{paramCondition.turnoverId},'%')
            </if>
            <if test="paramCondition.createTime != null and paramCondition.createTime != ''">
                and create_time like CONCAT('%',#{paramCondition.createTime},'%')
            </if>
    </select>

    <select id="findByTurnoverId" resultType="cn.stylefeng.guns.modular.warehousemanage.model.result.WmsWarehouseStockResult" parameterType="string">
        select
        <include refid="Base_Column_List"/>
        from wms_warehouse_stock where 1 = 1
        and turnover_id = #{turnoverId}
        order by create_time desc limit 1
    </select>

    <select id="findAll" resultType="cn.stylefeng.guns.modular.warehousemanage.model.params.StockSync">
        select * from temp_inventory
    </select>

    <update id="updateStock" parameterType="string">
        UPDATE  wms_warehouse_stock SET turnover_id = (SELECT barcode FROM wms_warehouse_turnover WHERE barcode = #{containerCode})
        WHERE  loca_number = #{locationCode}
    </update>
</mapper>
