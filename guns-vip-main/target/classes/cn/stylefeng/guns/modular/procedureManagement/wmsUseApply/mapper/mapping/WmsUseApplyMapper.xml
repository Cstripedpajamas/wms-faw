<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.mapper.WmsUseApplyMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.entity.WmsUseApply">
        <id column="id" property="id" />
        <result column="process_number" property="processNumber" />
        <result column="operator" property="operator" />
        <result column="material_id" property="materialId" />
        <result column="m_number" property="mNumber" />
        <result column="process_type" property="processType" />
        <result column="process_reason" property="processReason" />
        <result column="data_time" property="dataTime" />
        <result column="data_state" property="dataState" />
        <result column="scrap_material_id" property="scrapMaterialId" />
        <result column="scrap_num" property="scrapNum" />
        <result column="approvedby" property="approvedBy" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id AS "id", process_number AS "processNumber", operator AS "operator", material_id AS "materialId", m_number AS "mNumber", process_type AS "processType", process_reason AS "processReason", data_time AS "dataTime", data_state AS "dataState",
        scrap_material_id AS "scrapMaterialId",scrap_num AS "scrapNum",approvedby AS "approvedBy"
    </sql>


    <select id="customList" resultType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.result.WmsUseApplyResult" parameterType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.params.WmsUseApplyParam">
        select
        <include refid="Base_Column_List"/>
        from wms_use_apply where 1 = 1
            <if test="paramCondition.processNumber != null and paramCondition.processNumber != ''">
                and process_number like CONCAT('%',#{paramCondition.processNumber},'%')
            </if>
    </select>

    <select id="customMapList" resultType="map" parameterType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.params.WmsUseApplyParam">
        select
        <include refid="Base_Column_List"/>
        from wms_use_apply where 1 = 1
            <if test="paramCondition.processNumber != null and paramCondition.processNumber != ''">
                and process_number like CONCAT('%',#{paramCondition.processNumber},'%')
            </if>
    </select>

    <select id="customPageList" resultType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.result.WmsUseApplyResult" parameterType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.params.WmsUseApplyParam">
        select
        <include refid="Base_Column_List"/>
        from wms_use_apply where 1 = 1
            <if test="paramCondition.processNumber != null and paramCondition.processNumber != ''">
                and process_number like CONCAT('%',#{paramCondition.processNumber},'%')
            </if>
        <if test="paramCondition.operator != null and paramCondition.operator != ''">
            and operator = #{paramCondition.operator}
        </if>
            and process_type = 'B'
    </select>
    <select id="customPageList2" resultType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.result.WmsUseApplyResult" parameterType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.params.WmsUseApplyParam" >
        SELECT
        wms_use_apply.id AS "id",
        wms_use_apply.process_number AS "processNumber",
        wms_use_apply.operator AS "operator",
        wms_use_apply.material_id AS "materialId",
        wms_use_apply.m_number AS "mNumber",
        wms_use_apply.process_type AS "processType",
        wms_use_apply.process_reason AS "processReason",
        wms_use_apply.data_time AS "dataTime",
        wms_use_apply.data_state AS "dataState",
        wms_use_apply.scrap_material_id AS "scrapMaterialId",
        wms_use_apply.approvedby AS "approvedBy",
        wms_use_apply.scrap_num AS "scrapNum",
        wms_material_type.material_type AS "sMaterialType",
        wms_material_type.material_name AS "smaterialName",
        wms_material_type.material_sku  AS "smaterialSku",
        wms_material_type.plant  AS "splant",
        wms_material_type.material_sku  AS "sdiBatchNo",
        usewms_material_type.material_type AS "useMaterialType",
        usewms_material_type.material_name AS "useMaterialName",
        usewms_material_type.material_sku  AS "useMaterialSku",
        usewms_material_type.plant  AS "useplant",
        usewms_material_type.di_batchNo  AS "usediBatchNo",
        wms_user.user_name as "userName",
        wms_user.work_team as "workTeam",
        wms_material_type.sizes as "scrapMaterialSize",
        wms_material_type.sizes as "materialSize" ,
        wms_user.user_name as "approveduserName",
        wms_user.serial_number as "approvedserialNumber",
        wms_user.work_team as "approvedworkTeam"
        FROM wms_use_apply
        LEFT JOIN wms_material_type on wms_use_apply.scrap_material_id=wms_material_type.id
        LEFT JOIN wms_material_type AS usewms_material_type on wms_use_apply.material_id=usewms_material_type.id
        LEFT JOIN wms_user on wms_user.serial_number=operator and   wms_user.serial_number =wms_use_apply.approvedby
        where 1 = 1
        <if test="paramCondition.processNumber != null and paramCondition.processNumber != ''">
            and wms_use_apply.process_number like CONCAT('%',#{paramCondition.processNumber},'%')
        </if>
        <if test="paramCondition.operator != null and paramCondition.operator != ''">
            and wms_use_apply.operator like CONCAT('%',#{paramCondition.operator},'%')
        </if>
        <if test="paramCondition.useMaterialType != null and paramCondition.useMaterialType != ''">
            and usewms_material_type.material_type like CONCAT('%',#{paramCondition.useMaterialType},'%')
        </if>
        <if test="paramCondition.useMaterialName != null and paramCondition.useMaterialName != ''">
            and usewms_material_type.material_name like CONCAT('%',#{paramCondition.useMaterialName},'%')
        </if>
        <if test="paramCondition.useMaterialSku != null and paramCondition.useMaterialSku != ''">
            and usewms_material_type.material_sku like CONCAT('%',#{paramCondition.useMaterialSku},'%')
        </if>
        <if test="paramCondition.dataState != null and paramCondition.dataState != ''">
            and wms_use_apply.data_state like CONCAT('%',#{paramCondition.dataState},'%')
        </if>
        <if test="paramCondition.useplant != null and paramCondition.useplant != ''">
            and usewms_material_type.plant like CONCAT('%',#{paramCondition.useplant},'%')
        </if>
        <if test="paramCondition.usediBatchNo != null and paramCondition.usediBatchNo != ''">
            and usewms_material_type.di_batchNo like CONCAT('%',#{paramCondition.usediBatchNo},'%')
        </if>
        <if test="paramCondition.userName != null and paramCondition.userName != ''">
            and wms_user.user_name like CONCAT('%',#{paramCondition.userName},'%')
        </if>
        <if test="paramCondition.workTeam != null and paramCondition.workTeam != ''">
            and wms_user.work_team like CONCAT('%',#{paramCondition.workTeam},'%')
        </if>
        <if test="paramCondition.scrapMaterialSize != null and paramCondition.scrapMaterialSize != ''">
            and wms_material_type.sizes like CONCAT('%',#{paramCondition.scrapMaterialSize},'%')
        </if>
        <if test="paramCondition.materialSize != null and paramCondition.materialSize != ''">
            and wms_material_type.sizes like CONCAT('%',#{paramCondition.materialSize},'%')
        </if>
        <if test="paramCondition.approveduserName != null and paramCondition.approveduserName != ''">
            and wms_user.user_name like CONCAT('%',#{paramCondition.approveduserName},'%')
        </if>
        <if test="paramCondition.approvedserialNumber != null and paramCondition.approvedserialNumber != ''">
            and wms_user.serial_number like CONCAT('%',#{paramCondition.approvedserialNumber},'%')
        </if>
        <if test="paramCondition.approvedworkTeam != null and paramCondition.approvedworkTeam != ''">
            and wms_user.work_team like CONCAT('%',#{paramCondition.approvedworkTeam},'%')
        </if>
        order by wms_use_apply.data_time desc
    </select>

    <select id="customPageMapList" resultType="map" parameterType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.params.WmsUseApplyParam">
        select
        <include refid="Base_Column_List"/>
        from wms_use_apply where 1 = 1
            <if test="paramCondition.processNumber != null and paramCondition.processNumber != ''">
                and process_number like CONCAT('%',#{paramCondition.processNumber},'%')
            </if>
    </select>

    <select id="findById" resultType="cn.stylefeng.guns.modular.procedureManagement.wmsUseApply.model.result.WmsUseApplyResult" parameterType="string">
        select
        <include refid="Base_Column_List"/>
        from wms_use_apply where 1 = 1
        and id = #{id}
    </select>

</mapper>
