<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.stylefeng.guns.modular.base.purchaseorderinfo.mapper.WmsPurchaseOrderInfoMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.stylefeng.guns.modular.base.purchaseorderinfo.entity.WmsPurchaseOrderInfo">
        <id column="id" property="id" />
        <result column="pur_number" property="purNumber" />
        <result column="type" property="type" />
        <result column="material_type_id" property="materialTypeId" />
        <result column="material_type" property="materialType" />
        <result column="material_name" property="materialName" />
        <result column="material_sku" property="materialSku" />
        <result column="m_unit" property="mUnit" />
        <result column="m_number" property="mNumber" />
        <result column="arrival_time" property="arrivalTime" />
        <result column="arrival_state" property="arrivalState" />
        <result column="create_time" property="createTime" />
        <result column="received_quantity" property="receivedQuantity" />
        <result column="print_num" property="printNum" />
        <result column="acceptable_quantity" property="acceptableQuantity" />
        <result column="di_batchno" property="diBatchNo" />
        <result column="sizecol" property="sizecol" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id AS "id",sizecol As "sizecol", pur_number AS "purNumber", type AS "type", material_type_id AS "materialTypeId", material_type AS "materialType", material_name AS "materialName", material_sku AS "materialSku", m_unit AS "mUnit", m_number AS "mNumber", arrival_time AS "arrivalTime", arrival_state AS "arrivalState", create_time AS "createTime",received_quantity AS "receivedQuantity",print_num AS "printNum",acceptable_quantity AS "acceptableQuantity",di_batchno AS "diBatchNo",
        client As "client",purdocitemno As "purdocitemno",purdocno As "purdocno",purchasereqno As "purchasereqno",itemno As "itemno",purstockbillid As "purstockbillid",buyliststrdes As "buyliststrdes",createdby As "createdby",createddate As "createddate",docDate As "docDate",estimatedpriceindic As "estimatedpriceindic",matBrand As "matBrand",netvalue As "netvalue",ordpriceunit As "ordpriceunit",ordtype As "ordtype",plant As "plant",price As "price",promotion As "promotion",
        proposerdesc As "proposerdesc",proposerid As "proposerid",purgrp As "purgrp",purgrpdesc As "purgrpdesc",purOrg As "purOrg",purdocheaderid As "purdocheaderid",remark As "remark",remark1 As "remark1",storelocation As "storelocation",vendordesc As "vendordesc",vendorno As "vendorno",reqphone As "reqphone",plantdes As "plantdes",storelocationdes As "storelocationdes",unitdes As "unitdes",createdbydesc As "createdbydesc",statedesc As "statedesc",
        di_opertype As "diOperType",di_updatetime As "diUpdatetime",phone As "phone"
    </sql>


    <select id="customList" resultType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.result.WmsPurchaseOrderInfoResult" parameterType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.params.WmsPurchaseOrderInfoParam">
        select
        <include refid="Base_Column_List"/>
        from wms_purchase_order_info where 1 = 1
            <if test="paramCondition.id != null and paramCondition.id != ''">
                and id like CONCAT('%',#{paramCondition.id},'%')
            </if>
            <if test="paramCondition.purNumber != null and paramCondition.purNumber != ''">
                and pur_number like CONCAT('%',#{paramCondition.purNumber},'%')
            </if>
            <if test="paramCondition.type != null and paramCondition.type != ''">
                and type like CONCAT('%',#{paramCondition.type},'%')
            </if>
            <if test="paramCondition.materialTypeId != null and paramCondition.materialTypeId != ''">
                and material_type_id like CONCAT('%',#{paramCondition.materialTypeId},'%')
            </if>
            <if test="paramCondition.materialType != null and paramCondition.materialType != ''">
                and material_type like CONCAT('%',#{paramCondition.materialType},'%')
            </if>
            <if test="paramCondition.materialName != null and paramCondition.materialName != ''">
                and material_name like CONCAT('%',#{paramCondition.materialName},'%')
            </if>
            <if test="paramCondition.materialSku != null and paramCondition.materialSku != ''">
                and material_sku like CONCAT('%',#{paramCondition.materialSku},'%')
            </if>
            <if test="paramCondition.mUnit != null and paramCondition.mUnit != ''">
                and m_unit like CONCAT('%',#{paramCondition.mUnit},'%')
            </if>
            <if test="paramCondition.mNumber != null and paramCondition.mNumber != ''">
                and m_number like CONCAT('%',#{paramCondition.mNumber},'%')
            </if>
            <if test="paramCondition.arrivalTime != null and paramCondition.arrivalTime != ''">
                and arrival_time like CONCAT('%',#{paramCondition.arrivalTime},'%')
            </if>
            <if test="paramCondition.arrivalState != null and paramCondition.arrivalState != ''">
                and arrival_state like CONCAT('%',#{paramCondition.arrivalState},'%')
            </if>
            <if test="paramCondition.createTime != null and paramCondition.createTime != ''">
                and create_time like CONCAT('%',#{paramCondition.createTime},'%')
            </if>
    </select>

    <select id="customMapList" resultType="map" parameterType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.params.WmsPurchaseOrderInfoParam">
        select
        <include refid="Base_Column_List"/>
        from wms_purchase_order_info where 1 = 1
            <if test="paramCondition.id != null and paramCondition.id != ''">
                and id like CONCAT('%',#{paramCondition.id},'%')
            </if>
            <if test="paramCondition.purNumber != null and paramCondition.purNumber != ''">
                and pur_number like CONCAT('%',#{paramCondition.purNumber},'%')
            </if>
            <if test="paramCondition.type != null and paramCondition.type != ''">
                and type like CONCAT('%',#{paramCondition.type},'%')
            </if>
            <if test="paramCondition.materialTypeId != null and paramCondition.materialTypeId != ''">
                and material_type_id like CONCAT('%',#{paramCondition.materialTypeId},'%')
            </if>
            <if test="paramCondition.materialType != null and paramCondition.materialType != ''">
                and material_type like CONCAT('%',#{paramCondition.materialType},'%')
            </if>
            <if test="paramCondition.materialName != null and paramCondition.materialName != ''">
                and material_name like CONCAT('%',#{paramCondition.materialName},'%')
            </if>
            <if test="paramCondition.materialSku != null and paramCondition.materialSku != ''">
                and material_sku like CONCAT('%',#{paramCondition.materialSku},'%')
            </if>
            <if test="paramCondition.mUnit != null and paramCondition.mUnit != ''">
                and m_unit like CONCAT('%',#{paramCondition.mUnit},'%')
            </if>
            <if test="paramCondition.mNumber != null and paramCondition.mNumber != ''">
                and m_number like CONCAT('%',#{paramCondition.mNumber},'%')
            </if>
            <if test="paramCondition.arrivalTime != null and paramCondition.arrivalTime != ''">
                and arrival_time like CONCAT('%',#{paramCondition.arrivalTime},'%')
            </if>
            <if test="paramCondition.arrivalState != null and paramCondition.arrivalState != ''">
                and arrival_state like CONCAT('%',#{paramCondition.arrivalState},'%')
            </if>
            <if test="paramCondition.createTime != null and paramCondition.createTime != ''">
                and create_time like CONCAT('%',#{paramCondition.createTime},'%')
            </if>
    </select>

    <select id="customPageList" resultType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.result.WmsPurchaseOrderInfoResult" parameterType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.params.WmsPurchaseOrderInfoParam">
        select
        <include refid="Base_Column_List"/>
        from wms_purchase_order_info where 1 = 1 and arrival_state!=5
            <if test="paramCondition.id != null and paramCondition.id != ''">
                and id like CONCAT('%',#{paramCondition.id},'%')
            </if>
            <if test="paramCondition.purchasereqno != null and paramCondition.purchasereqno != ''">
                and purchasereqno like CONCAT('%',#{paramCondition.purchasereqno},'%')
            </if>
            <if test="paramCondition.purNumber != null and paramCondition.purNumber != ''">
                and pur_number like CONCAT('%',#{paramCondition.purNumber},'%')
            </if>
            <if test="paramCondition.purdocitemno != null and paramCondition.purdocitemno != ''">
                and purdocitemno like CONCAT('%',#{paramCondition.purdocitemno},'%')
            </if>
            <if test="paramCondition.purdocno != null and paramCondition.purdocno != ''">
                and purdocno like CONCAT('%',#{paramCondition.purdocno},'%')
            </if>
            <if test="paramCondition.sizecol != null and paramCondition.sizecol != ''">
                and sizecol like CONCAT('%',#{paramCondition.sizecol},'%')
            </if>
            <if test="paramCondition.storelocation != null and paramCondition.storelocation != ''">
                and storelocation like CONCAT('%',#{paramCondition.storelocation},'%')
            </if>
            <if test="paramCondition.vendordesc != null and paramCondition.vendordesc != ''">
                and vendordesc like CONCAT('%',#{paramCondition.vendordesc},'%')
            </if>
            <if test="paramCondition.diBatchNo != null and paramCondition.diBatchNo != ''">
                and di_batchno like CONCAT('%',#{paramCondition.diBatchNo},'%')
            </if>
            <if test="paramCondition.type != null and paramCondition.type != ''">
                and type like CONCAT('%',#{paramCondition.type},'%')
            </if>
            <if test="paramCondition.materialTypeId != null and paramCondition.materialTypeId != ''">
                and material_type_id like CONCAT('%',#{paramCondition.materialTypeId},'%')
            </if>
            <if test="paramCondition.materialType != null and paramCondition.materialType != ''">
                and material_type like CONCAT('%',#{paramCondition.materialType},'%')
            </if>
            <if test="paramCondition.materialName != null and paramCondition.materialName != ''">
                and material_name like CONCAT('%',#{paramCondition.materialName},'%')
            </if>
            <if test="paramCondition.materialSku != null and paramCondition.materialSku != ''">
                and material_sku like CONCAT('%',#{paramCondition.materialSku},'%')
            </if>
            <if test="paramCondition.mUnit != null and paramCondition.mUnit != ''">
                and m_unit like CONCAT('%',#{paramCondition.mUnit},'%')
            </if>
            <if test="paramCondition.mNumber != null and paramCondition.mNumber != ''">
                and m_number like CONCAT('%',#{paramCondition.mNumber},'%')
            </if>
            <if test="paramCondition.arrivalTime != null and paramCondition.arrivalTime != ''">
                and arrival_time like CONCAT('%',#{paramCondition.arrivalTime},'%')
            </if>
            <if test="paramCondition.arrivalState != null and paramCondition.arrivalState != ''">
                and arrival_state like CONCAT('%',#{paramCondition.arrivalState},'%')
            </if>
            <if test="paramCondition.createTime != null and paramCondition.createTime != ''">
                and create_time like CONCAT('%',#{paramCondition.createTime},'%')
            </if>
    </select>

    <select id="customPageList2"  resultType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.result.WmsPurchaseOrderInfoResult" parameterType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.params.WmsPurchaseOrderInfoParam">
      SELECT poi.*,wmt.id
        FROM `wms_purchase_order_info` as poi
            JOIN wms_material_type as wmt ON
                poi.`material_type_id` = wmt.`id`
            AND poi.`type` = '1'
            AND wmt.`label` = '1'
    </select>

    <select id="customPageMapList" resultType="map" parameterType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.params.WmsPurchaseOrderInfoParam">
        select
        <include refid="Base_Column_List"/>
        from wms_purchase_order_info where 1 = 1
            <if test="paramCondition.id != null and paramCondition.id != ''">
                and id like CONCAT('%',#{paramCondition.id},'%')
            </if>
            <if test="paramCondition.purNumber != null and paramCondition.purNumber != ''">
                and pur_number like CONCAT('%',#{paramCondition.purNumber},'%')
            </if>
            <if test="paramCondition.type != null and paramCondition.type != ''">
                and type like CONCAT('%',#{paramCondition.type},'%')
            </if>
            <if test="paramCondition.materialTypeId != null and paramCondition.materialTypeId != ''">
                and material_type_id like CONCAT('%',#{paramCondition.materialTypeId},'%')
            </if>
            <if test="paramCondition.materialType != null and paramCondition.materialType != ''">
                and material_type like CONCAT('%',#{paramCondition.materialType},'%')
            </if>
            <if test="paramCondition.materialName != null and paramCondition.materialName != ''">
                and material_name like CONCAT('%',#{paramCondition.materialName},'%')
            </if>
            <if test="paramCondition.materialSku != null and paramCondition.materialSku != ''">
                and material_sku like CONCAT('%',#{paramCondition.materialSku},'%')
            </if>
            <if test="paramCondition.mUnit != null and paramCondition.mUnit != ''">
                and m_unit like CONCAT('%',#{paramCondition.mUnit},'%')
            </if>
            <if test="paramCondition.mNumber != null and paramCondition.mNumber != ''">
                and m_number like CONCAT('%',#{paramCondition.mNumber},'%')
            </if>
            <if test="paramCondition.arrivalTime != null and paramCondition.arrivalTime != ''">
                and arrival_time like CONCAT('%',#{paramCondition.arrivalTime},'%')
            </if>
            <if test="paramCondition.arrivalState != null and paramCondition.arrivalState != ''">
                and arrival_state like CONCAT('%',#{paramCondition.arrivalState},'%')
            </if>
            <if test="paramCondition.createTime != null and paramCondition.createTime != ''">
                and create_time like CONCAT('%',#{paramCondition.createTime},'%')
            </if>
    </select>

    <insert id="insertListBatch">
        insert into wms_purchase_order_info (
        client,purdocitemno,purdocno,purchasereqno,itemno,purstockbillid,buyliststrdes,createdby,createddate,docDate,estimatedpriceindic,matBrand,netvalue,ordpriceunit,ordtype,
        plant,price,promotion,proposerdesc,proposerid,purgrp,purgrpdesc,purOrg,purdocheaderid,remark,remark1,storelocation,vendordesc,phone,reqphone,plantdes,storelocationdes,
        sizecol,unitdes,createdbydesc,statedesc,di_opertype,di_batchno,di_updatetime,vendorno,pur_number,type,material_type_id,material_type,material_name,material_sku,m_unit,
        m_number,arrival_time,arrival_state,create_time,received_quantity,print_num,acceptable_quantity
        )
        values
        <foreach collection="list" item="paramCondition" index="index" separator=",">
            (
            #{paramCondition.client},#{paramCondition.purdocitemno},#{paramCondition.purdocno},#{paramCondition.purchasereqno},#{paramCondition.itemno},
            #{paramCondition.purstockbillid},#{paramCondition.buyliststrdes},#{paramCondition.createdby},#{paramCondition.createddate},
            #{paramCondition.docDate},#{paramCondition.estimatedpriceindic},#{paramCondition.matBrand},#{paramCondition.netvalue},
            #{paramCondition.ordpriceunit},#{paramCondition.ordtype},#{paramCondition.plant},#{paramCondition.price},#{paramCondition.promotion},#{paramCondition.proposerdesc},
            #{paramCondition.proposerid},#{paramCondition.purgrp},#{paramCondition.purgrpdesc},
            #{paramCondition.purOrg},#{paramCondition.purdocheaderid},#{paramCondition.remark},#{paramCondition.remark1},#{paramCondition.storelocation},
            #{paramCondition.vendordesc},#{paramCondition.phone},#{paramCondition.reqphone},#{paramCondition.plantdes},#{paramCondition.storelocationdes},
            #{paramCondition.sizecol},#{paramCondition.unitdes},#{paramCondition.createdbydesc},#{paramCondition.statedesc},#{paramCondition.diOperType},#{paramCondition.diBatchNo},
            #{paramCondition.diUpdatetime},#{paramCondition.vendorno},#{paramCondition.purNumber},#{paramCondition.type},#{paramCondition.materialTypeId},
            #{paramCondition.materialType},#{paramCondition.materialName},#{paramCondition.materialSku},#{paramCondition.mUnit},#{paramCondition.mNumber},
            #{paramCondition.arrivalTime},#{paramCondition.arrivalState},#{paramCondition.createddate},#{paramCondition.receivedQuantity},#{paramCondition.printNum},
            #{paramCondition.acceptableQuantity}
            )
        </foreach>
    </insert>

    <update id="updateState" parameterType="string">
        update  wms_purchase_order_info set arrival_state = #{state} where 1=1 and id = #{orderId}
    </update>

    <update id="stopTask">
        update  wms_purchase_order_info set arrival_state = '2' where arrival_state =  '1'
    </update>

    <update id="updatePurdocnoState" parameterType="string">
        update  wms_purchase_order_info set arrival_state = #{state} where 1=1 and purdocno = #{purDocNO} and itemno = #{itemNO}
    </update>

    <select id="selectPurdocno" resultType="cn.stylefeng.guns.modular.base.purchaseorderinfo.model.result.WmsPurchaseOrderInfoResult" parameterType="string">
        select
        <include refid="Base_Column_List"/>
        from wms_purchase_order_info where 1 = 1 AND purdocno=#{purDocNO} AND itemno=#{itemNO} AND arrival_state=5
    </select>

    <update id="updatePurdocno" parameterType="string">
        UPDATE wms_purchase_order_info SET
        client=#{client},
        purdocitemno=#{purDocItemNo},
        buyliststrdes=#{buyListStrDes},
        storelocation=#{storeLocation},
        m_number=#{mNumber},
        material_sku=#{materialsku},
        acceptable_quantity=#{quantity},
        purchasereqno=#{purchasereqno},
        purdocheaderid=#{stockbillid},
        statedesc=#{statedesc},
        arrival_state=#{arrivalstate},
        createdby=#{createdby},
        material_type_id=#{typeid},
        type=#{type},
        material_type=#{materialType},
        material_name=#{materialName},
        m_unit=#{mUnit},
        received_quantity=0,
        print_num=0,
        pur_number=#{purNumber}
        WHERE 1=1
        AND purdocno=#{purDocNO}
        AND itemno=#{itemNO}
        AND arrival_state=5
    </update>
</mapper>
